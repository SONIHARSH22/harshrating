<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="/styles/main.css" />

    <title>Document</title>
</head>

<body>
    <h1>Hello foodies</h1>
    <h3>welcome <%=username %>
    </h3>

    <form action="/bycitybyareabyfood" method="get" onsubmit="toLowerCaseInputs()">
        <h2>
            Search By:
            <select name="city" id="cityInput">
                <option value="">Select City</option>
                <option value="mumbai">Mumbai</option>
                <option value="mandvi">Mandvi</option>
                <option value="ahmedabad">Ahmedabad</option>
                <option value="rajkot">Rajkot</option>
                <option value="delhi">Delhi</option>
                <!-- Add more options as needed -->
            </select>
            <select name="area" id="areaInput">
                <option value="">Select Area</option>
            </select>
            <select name="fooditem" id="fooditemInput">
                <option value="">Select Food Item</option>
            </select>
            <select name="storename" id="storenameInput">
                <option value="">Select Store Name</option>
            </select>
            <button type="submit">Submit</button>
        </h2>
    </form>

    <div class="mainouter" id="container">
        <% if (street.length===0) { %>
            <div class="not-found">
                <h2>No store found</h2>
            </div>
            <% } else { %>
                <% street.forEach(element=> { %>
                    <div class="outer" onclick="redirectToDetail('<%= element.id %>')">
                        <div class="supposeimage">
                            <p>.</p>
                        </div>

                        <div class="detail">
                            <li>
                                <h2>
                                    <%= element.store_name %>,
                                </h2>
                            </li>
                            <li>
                                <h4>
                                    <img src="/images/pin.png" alt="" />&nbsp <%= element.city %>,&nbsp <%= element.area %>,
                                            </h4>
                                            </li>
                                            <li>
                                                <h3>
                                                    <%= element.food_item %>,
                                                </h3>
                                            </li>
                                            <li>
                                                <h3>
                                                    <%= element.overall_rating %>,
                                                </h3>
                                            </li>
                                            </div>
                    </div>
                    <% }) %>
                        <% } %>
    </div>

    <script>
        function redirectToDetail(storeId) {
            // Redirect to the detail page with the storeId as a parameter
            window.location.href = '/showdetial?id=' + encodeURIComponent(storeId);
        }
    </script>

    <script>
            document.addEventListener('DOMContentLoaded', function () {
                const cityInput = document.getElementById('cityInput');
                const savedCity = localStorage.getItem('selectedCity');
                if (savedCity) {
                    cityInput.value = savedCity;
                    fetchDataAndPopulate(savedCity);
                }

                cityInput.addEventListener('change', function () {
                    const city = this.value;
                    localStorage.setItem('selectedCity', city);
                    fetchDataAndPopulate(city);
                });
            });

            function fetchDataAndPopulate(city) {
                const areaInput = document.getElementById('areaInput');
                const fooditemInput = document.getElementById('fooditemInput');
                const storenameInput = document.getElementById('storenameInput');

                if (city) {
                    fetch(`/fetchData?city=${city}`)
                        .then(response => response.json())
                        .then(data => {
                            populateSelect(areaInput, data.areas, 'Select Area');
                            populateSelect(fooditemInput, data.fooditems, 'Select Food Item');
                            populateSelect(storenameInput, data.storename, 'Select Store Name');
                        })
                        .catch(error => {
                            console.error('Error fetching data:', error);
                        });
                } else {
                    clearSelect(areaInput, 'Select Area');
                    clearSelect(fooditemInput, 'Select Food Item');
                    clearSelect(storenameInput, 'Select Store Name');
                }
            }

            function populateSelect(selectElement, options, placeholder) {
                selectElement.innerHTML = `<option value="">${placeholder}</option>`;
                const uniqueOptions = [...new Set(options)]; // Remove duplicates
                uniqueOptions.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    selectElement.appendChild(opt);
                });
            }

            function clearSelect(selectElement, placeholder) {
                selectElement.innerHTML = `<option value="">${placeholder}</option>`;
            }

            function toLowerCaseInputs() {
                    const inputs = document.querySelectorAll('input[type="text"]');
                    inputs.forEach(input => {
                        input.value = input.value.toLowerCase();
                    });
                }
            </script>
</body>

</html>